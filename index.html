<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>유아른 계산기</title>
  <style>
    body { font-family: Pretendard, sans-serif; margin:20px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(185px,1fr)); gap:16px; }
    .product { border:1px solid #ddd; border-radius:12px; padding:12px; text-align:center; cursor:pointer; }
    .product img { width:50px; height:50px; object-fit:contain; margin-bottom:8px; }
    .p-name { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; text-align:left; }
    .p-price { font-size:13px; color:#0070f3; margin-top:4px; text-align:left; }
    .qtyRow { margin-top:8px; display:flex; justify-content:center; align-items:center; gap:6px; }
    .btn { border:1px solid #aaa; border-radius:6px; padding:2px 6px; background:#f9f9f9; cursor:pointer; }
    .badge { min-width:20px; display:inline-block; text-align:center; }
    .selected { border:2px solid #0070f3; }

    #cart { margin-top:32px; }
    table { width:100%; border-collapse:collapse; }
    th,td { border:1px solid #ddd; padding:8px; font-size:13px; text-align:center; }
    td.nameCell { width:70%; text-align:left; } /* 상품명 칸 폭 70% */
    .qtyCtl { display:flex; justify-content:center; align-items:center; gap:4px; }
    .btn-sm { border:1px solid #aaa; border-radius:4px; padding:0 4px; cursor:pointer; }

    .totals { margin-top:16px; }
    .totalLine { display:flex; justify-content:space-between; margin:4px 0; font-size:14px; }
    .totalLine strong { font-size:15px; }
    .gift { color:#0070f3; font-weight:600; }
    #pay { margin-top:16px; padding:10px 20px; font-size:15px; border:none; background:#0070f3; color:#fff; border-radius:8px; cursor:pointer; }
  </style>
</head>
<body>

<h2>유아른 계산기</h2>

<div id="cats"></div>

<div id="cart">
  <div id="cartEmpty">장바구니가 비어 있습니다.</div>
  <div id="cartWrap" style="display:none;">
    <table>
      <thead>
        <tr><th>상품명</th><th>수량</th><th>단가</th><th>합계</th></tr>
      </thead>
      <tbody id="cartBody"></tbody>
    </table>
    <div class="totals">
      <div class="totalLine"><span>총합</span><strong id="grand">0원</strong></div>
      <div class="totalLine"><span>총 수량</span><strong id="totalQty">0개</strong></div>
      <div class="totalLine gift"><span>사은품</span><span id="gift">없음</span></div>
    </div>
    <button id="pay">제출하기</button>
  </div>
</div>
<script>
const IMG_BASE = "images"; 

// 상품 데이터 (23개 전부)
const products = [
  {key:"p1", name:"제품1", price:10000, img:"p1.jpg"},
  {key:"p2", name:"제품2", price:20000, img:"p2.jpg"},
  {key:"p3", name:"제품3", price:30000, img:"p3.jpg"},
  {key:"p4", name:"제품4", price:15000, img:"p4.jpg"},
  {key:"p5", name:"제품5", price:12000, img:"p5.jpg"},
  {key:"p6", name:"제품6", price:22000, img:"p6.jpg"},
  {key:"p7", name:"제품7", price:25000, img:"p7.jpg"},
  {key:"p8", name:"제품8", price:18000, img:"p8.jpg"},
  {key:"p9", name:"제품9", price:14000, img:"p9.jpg"},
  {key:"p10", name:"제품10", price:17000, img:"p10.jpg"},
  {key:"p11", name:"제품11", price:21000, img:"p11.jpg"},
  {key:"p12", name:"제품12", price:16000, img:"p12.jpg"},
  {key:"p13", name:"제품13", price:19000, img:"p13.jpg"},
  {key:"p14", name:"제품14", price:24000, img:"p14.jpg"},
  {key:"p15", name:"제품15", price:26000, img:"p15.jpg"},
  {key:"p16", name:"제품16", price:28000, img:"p16.jpg"},
  {key:"p17", name:"제품17", price:30000, img:"p17.jpg"},
  {key:"p18", name:"제품18", price:32000, img:"p18.jpg"},
  {key:"p19", name:"제품19", price:34000, img:"p19.jpg"},
  {key:"p20", name:"제품20", price:36000, img:"p20.jpg"},
  {key:"p21", name:"제품21", price:38000, img:"p21.jpg"},
  {key:"p22", name:"제품22", price:40000, img:"p22.jpg"},
  {key:"p23", name:"제품23", price:42000, img:"p23.jpg"}
];
const productMap = Object.fromEntries(products.map(p=>[p.key,p]));

const catsEl=document.getElementById('cats');
const cartEmptyEl=document.getElementById('cartEmpty');
const cartWrapEl=document.getElementById('cartWrap');
const cartBodyEl=document.getElementById('cartBody');
const grandEl=document.getElementById('grand');
const giftEl=document.getElementById('gift');
let cart={};

// 상품 카드 출력
catsEl.innerHTML=`
  <div class="cat"><h3>카테고리</h3>
  <div class="grid">
    ${products.map(p=>`
      <div class="product" id="card-${p.key}" onclick="add('${p.key}')">
        <img class="p-thumb" src="${IMG_BASE}/${p.img}" alt="">
        <div class="p-info">
          <div class="p-name">${p.name}</div>
          <div class="p-price">${p.price.toLocaleString()}원</div>
        </div>
        <div class="qtyRow">
          <button class="btn" onclick="event.stopPropagation();sub('${p.key}')">−</button>
          <span class="badge" id="badge-${p.key}">0</span>
          <button class="btn" onclick="event.stopPropagation();add('${p.key}')">＋</button>
        </div>
      </div>
    `).join('')}
  </div></div>
`;

function add(k){ cart[k]=(cart[k]||0)+1; render(); }
function sub(k){ if(cart[k]){ cart[k]--; if(cart[k]<=0) delete cart[k]; render(); }}

function giftBy(total){
  if(total>=100000) return "마스크팩 + 립밤 중 택1 + 리사이클파우치";
  if(total>=50000)  return "마스크팩 + 립밤 중 택1";
  if(total>=30000)  return "마스크팩";
  return "없음";
}

function render(){
  Object.keys(productMap).forEach(k=>{
    document.getElementById(`badge-${k}`).textContent=String(cart[k]||0);
    const card=document.getElementById(`card-${k}`);
    if(cart[k]>0) card.classList.add("selected");
    else card.classList.remove("selected");
  });

  const keys=Object.keys(cart);
  if(!keys.length){
    cartEmptyEl.style.display='';
    cartWrapEl.style.display='none';
    grandEl.textContent='0원';
    giftEl.textContent='없음';
    document.getElementById('totalQty').textContent='0개';
    return;
  }
  cartEmptyEl.style.display='none';
  cartWrapEl.style.display='';

  let total=0,totalQty=0;
  cartBodyEl.innerHTML=keys.map(k=>{
    const p=productMap[k],q=cart[k],sub=q*p.price;
    total+=sub; totalQty+=q;
    return `<tr data-key="${k}">
      <td class="nameCell" title="${p.name}">${p.name}</td>
      <td><div class="qtyCtl">
        <button class="btn-sm" data-act="minus">−</button>
        <span>${q}</span>
        <button class="btn-sm" data-act="plus">＋</button>
      </div></td>
      <td>${p.price.toLocaleString()}원</td>
      <td>${sub.toLocaleString()}원</td>
    </tr>`;
  }).join('');

  grandEl.textContent=`${total.toLocaleString()}원`;
  giftEl.textContent=giftBy(total);
  document.getElementById('totalQty').textContent=`${totalQty}개`;
}
cartBodyEl.addEventListener('click',e=>{
  const btn=e.target.closest('button');
  if(!btn) return;
  const tr=e.target.closest('tr');
  const key=tr.dataset.key;
  if(btn.dataset.act==='minus') sub(key);
  if(btn.dataset.act==='plus') add(key);
});

document.getElementById('pay').addEventListener('click',()=>{
  if(!Object.keys(cart).length){ alert("선택된 제품이 없습니다."); return; }
  const formData=new FormData();

  // 23개 entry 매핑
  if(cart["p1"]) formData.append("entry.641954362", cart["p1"]);
  if(cart["p2"]) formData.append("entry.73760492", cart["p2"]);
  if(cart["p3"]) formData.append("entry.527065283", cart["p3"]);
  if(cart["p4"]) formData.append("entry.1954562651", cart["p4"]);
  if(cart["p5"]) formData.append("entry.661056142", cart["p5"]);
  if(cart["p6"]) formData.append("entry.358376705", cart["p6"]);
  if(cart["p7"]) formData.append("entry.1894876668", cart["p7"]);
  if(cart["p8"]) formData.append("entry.2043302855", cart["p8"]);
  if(cart["p9"]) formData.append("entry.209373553", cart["p9"]);
  if(cart["p10"]) formData.append("entry.425801880", cart["p10"]);
  if(cart["p11"]) formData.append("entry.1513994656", cart["p11"]);
  if(cart["p12"]) formData.append("entry.2061672077", cart["p12"]);
  if(cart["p13"]) formData.append("entry.1272730298", cart["p13"]);
  if(cart["p14"]) formData.append("entry.2136390372", cart["p14"]);
  if(cart["p15"]) formData.append("entry.61250229", cart["p15"]);
  if(cart["p16"]) formData.append("entry.1050339042", cart["p16"]);
  if(cart["p17"]) formData.append("entry.202944705", cart["p17"]);
  if(cart["p18"]) formData.append("entry.1337141345", cart["p18"]);
  if(cart["p19"]) formData.append("entry.1635291501", cart["p19"]);
  if(cart["p20"]) formData.append("entry.2132279447", cart["p20"]);
  if(cart["p21"]) formData.append("entry.1886270070", cart["p21"]);
  if(cart["p22"]) formData.append("entry.1329246249", cart["p22"]);
  if(cart["p23"]) formData.append("entry.307730166", cart["p23"]);

  fetch("https://docs.google.com/forms/d/e/1FAIpQLSdHqrnkW6r7.../formResponse",{
    method:"POST",
    body:formData,
    mode:"no-cors"
  });

  alert("전송 완료!");
  cart={}; render();
});
</script>
</body>
</html>
